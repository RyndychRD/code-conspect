### Хранимые процедуры
Просто оставлю это здесь для напоминания что они существуют. По факту их использовать попа боль моя дырка задница, я пока не увидел ни одного хорошего примера их использования, который нельзя было бы вынести в обычный код. И это было бы гораздо удобнее. В общем, я еще не осознал всю силу этой стороны SQL

### Дополнительные математические функции

| Имя функции        | Описание                                                                                                                      |
|--------------------|-------------------------------------------------------------------------------------------------------------------------------|
| POW(num, power)    | Вычисляет число в указанной степени                                                                                           |
| SQRT(num)          | Вычисляет квадратный корень числа                                                                                             |
| LOG(base, num)     | Вычисляет логарифм числа по указанному основанию                                                                              |
| EXP(num)           | Вычисляет enum                                                                                                                |
| SIN(num)           | Вычисляет синус числа                                                                                                         |
| COS(num)           | Вычисляет косинус числа                                                                                                       |
| TAN(num)           | Вычисляет тангенс числа                                                                                                       |
| CEIL(num)          | Округление в большую сторону                                                                                                  |
| FLOOR(num)         | Округление в меньшую сторону                                                                                                  |
| ROUND(num)         | Математическое округление                                                                                                     |
| TRUNCATE(num,num2) | Отбрасывает до num2 знаков после запятой. При этом можно указывать отрицательное число, что занулит цифры справ перед запятой |
| SIGN (num)         | Вернет -1 если отрицательное, 0 если 0 и 1 если положительное                                                                 |
| ABS(num)           | Вернет модуль числа                                                                                                           |


### Функции работы с датой

Основные функции мне и так известны и перечислять я их не буду. А вот функция `TIMESTAMPDIFF`, которая в нужном формате отдает точное количество лет, месяцев или дней между 2 датами - очень интересна)
Синтаксис: `TIMESTAMPDIFF(YEAR, '2003-07-03 14:10:26', NOW());`. Вместо YEAR можно подставить MONTH, DAY, HOUR, MINUTE - получим очень точное значение

### CAST

Функция конвертации данных по типам. Я про нее знаю, но этот момент достаточно важный, чтобы его указать явно

Синтаксис: `SELECT CAST(12005.6 AS DECIMAL)`

Если скастовать тип невозможно - вернет NULL

| Тип              | Описание                                                                                                                                                                                         |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| DATE             | Конвертирует значение в DATE. Формат: "YYYY-MM-DD".                                                                                                                                              |
| DATETIME         | Конвертирует значение в DATETIME. Формат: "YYYY-MM-DD hh:mm:ss".                                                                                                                                 |
| TIME             | Конвертирует значение в TIME. Формат: "hh:mm:ss".                                                                                                                                                |
| DECIMAL[(M[,D])] | Конвертирует значение в DECIMAL. Имеет два необязательных аргумента M и D, определяющих максимальное количество знаков до и после запятой соответственно. По умолчанию, D равен 0, а M равен 10. |
| CHAR[(N)]        | Конвертирует значение в CHAR. В качестве необязательного аргумента можно передать максимальную длину строки.                                                                                     |
| SIGNED           | Конвертирует значение в значение BIGINT.                                                                                                                                                         |
| UNSIGNED         | Конвертирует значение в беззнаковое значение BIGINT.                                                                                                                                             |
| BINARY           | Конвертирует значение в BINARY.                                                                                                                                                                  |
| YEAR             | Конвертирует значение в год.                                                                                                                                                                     |

### Транзакции
Если у нас есть какая-то информация в БД, которую одновременно изменяют несколько пользователей или нужно последовательно выполнить несколько запросов для того чтобы ее успешно совершить - применяются транзакции. Транзакции сохраняют изменения данных временно в памяти БД, и только после специальной команды применяют их. Также транзакции блокируют некоторые строки(таблицы или блоки строк(страницы), зависит от настроек СУБД) на изменение, и остальные запросы должны дождаться освобождения данных до момента как они смогут быть выполнены

Синтаксис транзакций следующий:
```sql
START TRANSACTION;

-- Проверка наличия достаточного баланса у отправителя
SELECT @balance := user_balance FROM accounts WHERE user_id = 1;

-- Если средств недостаточно, отмена транзакции(забываем все изменения как будто никакого кода не выполняли)
IF @balance < 1000 THEN
ROLLBACK;
END IF;

-- Создаем точку сохранения перед изменением баланса первого пользователя
SAVEPOINT before_updating_user_1;
UPDATE accounts SET balance = balance + 100 WHERE user_id = 1;

-- Проверка условия для первого пользователя
-- например, проверяем логику бизнес-правил

-- Здесь мы предполагаем, что условие не выполнилось, и нам нужно отменить изменение баланса
ROLLBACK TO SAVEPOINT before_updating_user_1;

-- Обновляем баланс для второго пользователя
UPDATE accounts SET balance = balance + 200 WHERE user_id = 2;

-- Завершаем транзакцию, применив изменения
COMMIT;

```

Точки сохранения - это точка, которая начинает блок, который мы можем откатить. То есть если у нас между точкой сохранения и роллбэком к этой точке произошла ошибка, то мы откатываемся к точке сохранения, пропускаем блок с ошибкой и выполняем все что после роллбэка